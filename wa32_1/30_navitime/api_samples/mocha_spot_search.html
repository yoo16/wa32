<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <script src='http://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js'></script>
</head>

<body>
  <h1>mocha スポット検索 サンプルコード</h1>
  <p>
    <input type="text" name="search-box" placeholder="例：東京タワー" style="height: 20px;">
    <button type="button" onclick="search()">検索</button>
  </p>
  <div>
    name(スポット名)：<p id=name></p>
  </div>
  <div>
    address(住所)：<p id=address></p>
  </div>
  <div>
    lat(緯度):<p id=lat></p>
    lon(経度):<p id=lon></p>
  </div>

  <!-- axiosを使用するために必要な記載です -->
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script>
    // 固定部を定義
    // {SID}の部分にはお伝えしたSIDを設定してください
    //let baseUrl = 'https://api-challenge.navitime.biz/v1s/{SID}';
    let baseUrl = 'https://api-challenge.navitime.biz/v1s/{SID}';

    function search() {
      // 画面表示の初期化
      $('#name').empty();
      $('#address').empty();
      $('#lat').empty();
      $('#lon').empty();
      // 検索窓に入力した値を取得
      let word = $('input[name="search-box"]').val();
      /* スポット情報を取得する
            API: /spot/list
            パラメータ：
              word: フリーワード検索の値を指定
              datum: 測地系を指定（おまじない）
      */
      let url = baseUrl + '/spot/list?word=' + word + '&datum=wgs84'
      // mochaリクエストをコンソールに表示
      console.log(url);
      // axiosを利用してmochaにリクエストを送信し、レスポンスを受信する
      axios
        // リクエストしたいURLをを指定
        .get(url)
        // 通信成功時に実行する関数
        .then(connectSuccessSpot)
        // エラー発生時に実行する関数
        .catch(connectFailure)
    }

    /* mocha通信 成功時の処理
     * resuponse: mochaレスポンス(JSON形式)
    **/
    function connectSuccessSpot(response) {
      // ヒットしたスポットの一番上位のデータを取得
      let spot = response.data.items[0];
      // スポットの一番上位のデータの中の nameオブジェクト(スポット名) を表示
      $('#name').append(spot.name);
      // スポットの一番上位のデータの中の address_nameオブジェクト(住所) を表示
      $('#address').append(spot.address_name);
      // スポット情報の中の緯度経度(coord)を取得
      let coord = spot.coord;
      // スポットの緯度(lat) を表示
      $('#lat').append(coord.lat);
      // スポットの経度(lon) を表示
      $('#lon').append(coord.lon);
    }

    /* mocha通信 失敗時の処理 */
    function connectFailure(error) {
      alert(error);
    }
  </script>
</body>

</html>